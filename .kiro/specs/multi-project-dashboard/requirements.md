# 要件定義書

## はじめに

ProjectLensは、BacklogのMCP Serverを活用して複数プロジェクトのチケットをAIで整理・可視化するデスクトップアプリケーションです。ユーザーが複数のプロジェクトを横断的に管理し、「今何をすべきか」を瞬時に把握できることを目的としています。

## 要件

### 要件1：複数プロジェクトダッシュボード表示

**ユーザーストーリー：** プロジェクトマネージャーとして、複数のBacklogプロジェクトのチケットを一つの画面で確認したいので、横断的な作業状況を把握できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがアプリケーションを起動した時 THEN システムは複数プロジェクトのダッシュボード画面を表示する
2. WHEN ダッシュボードが表示された時 THEN システムは設定されたすべてのBacklogプロジェクトからチケット情報を取得して表示する
3. WHEN チケット情報を表示する時 THEN システムは完了していない状態の、自分に割り当てられたチケット、自分がコメントしたチケット、自分にメンションされたチケット、自分に通知先として割り当てられたチケットを表示する
4. WHEN チケット情報を表示する時 THEN システムは関連タスクとして、完了していない状態で自分が担当者にアサインされていないが複数回コメントしているチケットまたは通知先に含められているチケットを別セクションで表示する

### 要件2：AIによる優先度分析と推奨

**ユーザーストーリー：** 開発者として、多数のチケットの中から今日取り組むべきタスクをAIに推奨してもらいたいので、効率的に作業を進められるようにしたい

#### 受け入れ基準

1. WHEN チケットデータが取得された時 THEN システムはAIを使用してチケットの優先度を分析する
2. WHEN 優先度分析が完了した時 THEN システムは「緊急対応セクション」「今日の推奨タスク」「関連タスク」を表示する
3. WHEN 関連タスクセクションを表示する時 THEN システムは自分が担当者ではないが関心が高いと判定されるチケット（複数回コメント済み、または通知先に設定済み）を表示する
4. WHEN AIが分析を実行する時 THEN システムはすべての処理をローカルで実行し、チケット内容を外部に送信しない

### 要件3：プロジェクト重み設定

**ユーザーストーリー：** プロジェクトマネージャーとして、プロジェクトごとに重要度を設定したいので、AIの優先度判定に自分の判断を反映させたい

#### 受け入れ基準

1. WHEN ユーザーが設定画面を開いた時 THEN システムはプロジェクト重み設定画面を表示する
2. WHEN プロジェクト重み設定画面が表示された時 THEN システムは各プロジェクトに対して1-10のスコアを設定できるインターフェースを提供する
3. WHEN プロジェクト重みが変更された時 THEN システムは設定をローカルに保存し、AIの優先度判定に反映する

### 要件4：Backlog MCP Server連携

**ユーザーストーリー：** システム管理者として、複数のBacklogワークスペースのAPIを通じてチケット情報を安全に取得したいので、MCP Serverを介した連携を実現したい

#### 受け入れ基準

1. WHEN アプリケーションが起動した時 THEN システムはDocker上で動作するBacklog MCP Serverに接続する
2. WHEN MCP Serverに接続した時 THEN システムは設定された各BacklogワークスペースのAPIを通じてチケット情報を取得する
3. WHEN ユーザーが設定画面でBacklog設定を開いた時 THEN システムは複数のワークスペース（BACKLOG_DOMAIN、BACKLOG_API_KEY）を設定できるインターフェースを提供する
4. WHEN 新しいワークスペースが追加された時 THEN システムは設定を暗号化してローカルに保存し、MCP Serverの設定に反映する
5. IF MCP Serverとの接続に失敗した場合 THEN システムは適切なエラーメッセージを表示し、再接続オプションを提供する

### 要件5：マルチAIプロバイダー対応

**ユーザーストーリー：** 開発者として、複数のAIプロバイダー（OpenAI、Claude、Gemini）から選択したいので、自分の環境や予算に合わせてAIを利用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーが設定画面でAI設定を開いた時 THEN システムはOpenAI、Anthropic Claude、Google Gemini の選択肢を表示する
2. WHEN AIプロバイダーが選択された時 THEN システムは対応するAPIキーの入力フィールドを表示する
3. WHEN APIキーが入力された時 THEN システムはキーを暗号化してローカルに保存する

### 要件6：セキュアな認証情報管理

**ユーザーストーリー：** セキュリティ担当者として、APIキーやアクセストークンが安全に管理されることを確認したいので、暗号化された保存機能を実装したい

#### 受け入れ基準

1. WHEN APIキーやアクセストークンが入力された時 THEN システムは情報を暗号化してローカルファイルシステムに保存する
2. WHEN 暗号化された認証情報を使用する時 THEN システムは復号化してメモリ上でのみ使用し、外部に送信しない
3. WHEN アプリケーションが終了した時 THEN システムはメモリ上の認証情報をクリアする

### 要件7：クロスプラットフォーム対応

**ユーザーストーリー：** 開発チームとして、Windows、macOS、Linuxの各環境で同じアプリケーションを使用したいので、クロスプラットフォーム対応を実現したい

#### 受け入れ基準

1. WHEN アプリケーションがWindows環境で実行された時 THEN システムは正常に動作し、すべての機能が利用可能である
2. WHEN アプリケーションがmacOS環境で実行された時 THEN システムは正常に動作し、すべての機能が利用可能である
3. WHEN アプリケーションがLinux環境で実行された時 THEN システムは正常に動作し、すべての機能が利用可能である

#### 非機能要件

##### 7.1 開発環境要件
- **対象OS**: Windows 10/11, macOS 12+, Ubuntu 20.04+
- **開発環境**: Node.js 20+, Yarn 1.22+, Docker必須
- **特記事項**: macOSでは開発サーバーの特別設定が必要

##### 7.2 必須依存サービス
- **Docker**: 必須（Docker Desktop または Docker Engine）
- **要件**: Docker API利用可能、MCP Server コンテナ実行可能
- **制約**: Docker未起動時はアプリケーション機能を制限

##### 7.3 エラー耐性要件
- **必須サービス障害時**: ユーザーに明確な復旧手順を提示
- **一時的障害**: 自動リトライ機能（最大3回）
- **永続的障害**: 段階的エスカレーション（通知→ダイアログ→ブロック）

### 要件8：関連タスクの判定と表示

**ユーザーストーリー：** 開発者として、自分が直接担当していないが関心の高いチケットを把握したいので、関連タスクとして別途表示してもらいたい

#### 受け入れ基準

1. WHEN システムがチケット情報を分析する時 THEN システムは完了していない状態で自分が2回以上コメントしているチケットを関連タスクとして識別する
2. WHEN システムがチケット情報を分析する時 THEN システムは完了していない状態で自分が通知先に設定されているが担当者ではないチケットを関連タスクとして識別する
3. WHEN 関連タスクが識別された時 THEN システムは関連タスクセクションに該当チケットを表示し、関連理由（コメント回数、通知先設定）を併記する
4. WHEN 関連タスクを表示する時 THEN システムは担当チケットとは視覚的に区別できるデザインで表示する

### 要件9：オフライン対応とキャッシュ機能

**ユーザーストーリー：** 移動中の開発者として、インターネット接続が不安定な環境でも過去のチケット情報を確認したいので、ローカルキャッシュ機能を利用したい

#### 受け入れ基準

1. WHEN チケット情報が取得された時 THEN システムは情報をローカルキャッシュに保存する
2. WHEN インターネット接続が利用できない時 THEN システムはキャッシュされた情報を表示し、オフライン状態であることを通知する
3. WHEN インターネット接続が復旧した時 THEN システムは自動的に最新情報を取得してキャッシュを更新する

## ユーザビリティ要件

### 8.1 エラー時ユーザー誘導
- **ブロッキングエラー**: 解決まで他操作を制限
- **ガイダンス提供**: OS別の具体的解決手順を表示
- **診断情報**: システム状態の可視化

#### 受け入れ基準
1. WHEN 必須サービス（Docker）が利用できない時 THEN システムは他の操作を完全に制限する
2. WHEN エラーが発生した時 THEN システムは具体的な解決手順を段階的に提示する
3. WHEN 「インストールガイド」が要求された時 THEN システムはOS別の詳細なインストール手順を表示する
4. WHEN エラーダイアログが表示された時 THEN システムは背景クリック・ESCキー・クローズボタンを無効化する

### 8.2 通知システム要件
- **階層的通知**: Info/Warning → Error → Critical(Blocking)
- **重複防止**: 同一エラーの重複通知を防ぐ
- **アクション提示**: 具体的な解決アクションを提供

#### 受け入れ基準
1. WHEN 通知が表示される時 THEN システムは重要度に応じて適切な表示方法を選択する
2. WHEN 再試行処理中の時 THEN システムは重複した通知の表示を抑制する
3. WHEN エラー通知が表示される時 THEN システムは解決のための具体的なアクションボタンを提供する